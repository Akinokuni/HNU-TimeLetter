# 数据模型 (Data Model)

> **Single Source of Truth**: 本文档定义基于 [types.ts](file:///c:/Documents/Galgame群活动/与她的海大时光笺/web/src/lib/types.ts)。如遇冲突，以代码为准。

## 核心实体

### 1. Story (故事)
对应飞书多维表格中的一行记录。

| 字段名 | 类型 | 说明 | 对应飞书字段 |
| :--- | :--- | :--- | :--- |
| `id` | string | 唯一标识符 | 自动生成/记录ID |
| `characterId` | string | 角色 ID | `角色ID` |
| `characterName` | string | 角色名称 | `角色名` |
| `avatarUrl` | string | Q版头像 URL | `头像OSS_URL` (优先) 或 `头像` |
| `mainImageUrl` | string | 高清大图 URL | `大图OSS_URL` (优先) 或 `大图` |
| `content` | string | 故事文本 | `故事内容` |
| `author` | string | 投稿人/作者 | `投稿人` |
| `date` | string | 日期 (YYYY.MM.DD) | `日期` |
| `locationId` | string | 关联地点 ID | `地点ID` |

### 2. LocationPoint (地点)
前端聚合使用的地点数据结构。

| 字段名 | 类型 | 说明 |
| :--- | :--- | :--- |
| `id` | string | 地点唯一标识 (如 `lib-001`) |
| `name` | string | 地点名称 (如 `图书馆`) |
| `x` | number | SVG 横坐标百分比 (0-100) |
| `y` | number | SVG 纵坐标百分比 (0-100) |
| `stories` | Story[] | 该地点下的所有故事集合 |

## 数据流向

1. **飞书多维表格**: 运营人员录入数据。
2. **Sync Script (`npm run sync`)**:
   - 拉取 `Published` 状态的记录。
   - 下载附件 -> 上传阿里云 OSS -> 获取永久 URL。
   - 生成 [content.json](file:///c:/Documents/Galgame群活动/与她的海大时光笺/web/src/data/content.json)。
3. **Frontend**: 组件直接读取 `content.json` 渲染。

## 状态管理
全局状态由 Zustand ([store.ts](file:///c:/Documents/Galgame群活动/与她的海大时光笺/web/src/lib/store.ts)) 管理：
- `isEnvelopeOpened`: 信封是否已拆开。
- `selectedLocationId`: 当前选中的地点。
- `currentStoryIndex`: 当前阅读的故事索引。
