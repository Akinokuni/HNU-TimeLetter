# 飞书多维表格配置指南

## 问题说明

当前遇到的问题是：从知识库 URL 中提取的 ID (`ScDawoedLivEd0kvLKjcaYIjn98`) 不是多维表格的 `app_token`，导致 API 调用失败。

## 如何获取正确的 app_token

### 方法 1：通过多维表格界面获取（推荐）

1. 在飞书中打开您的多维表格
2. 点击右上角的 **"..."** (更多选项)
3. 选择 **"高级"** -> **"获取 app_token"**
4. 复制显示的 app_token

### 方法 2：通过分享链接获取

1. 在多维表格中点击右上角的 **"分享"** 按钮
2. 选择 **"复制链接"**
3. 链接格式通常为：`https://xxx.feishu.cn/base/{app_token}?table={table_id}`
4. 从链接中提取 `app_token`

### 方法 3：将表格从知识库移出（如果可以）

如果表格嵌入在知识库中，可以考虑：
1. 创建一个独立的多维表格
2. 将数据复制过去
3. 使用独立表格的 app_token

## 当前配置

根据您提供的 URL：
```
https://himematsu.feishu.cn/wiki/ScDawoedLivEd0kvLKjcaYIjn98?table=tblWufNIW5TtO3Am&view=vewF6fILf0
```

我们已知：
- **Wiki/知识库 ID**: `ScDawoedLivEd0kvLKjcaYIjn98`
- **Table ID**: `tblWufNIW5TtO3Am`
- **View ID**: `vewF6fILf0`

但我们还需要：
- **App Token**: ？（需要通过上述方法获取）

## 配置步骤

1. 按照上述方法获取正确的 `app_token`
2. 更新 `.env.local` 文件：

```bash
FEISHU_APP_ID=cli_a8f7fa2cdc38d00c
FEISHU_APP_SECRET=xwUmOcayheyUOkMaREp0SdTv0wZFv1cC
FEISHU_APP_TOKEN=<您获取的 app_token>
FEISHU_TABLE_ID=tblWufNIW5TtO3Am
```

3. 运行测试脚本验证：

```bash
npx tsx src/scripts/test-feishu-correct.ts
```

## 权限配置

确保您的飞书应用具有以下权限：
- ✅ 查看、评论、编辑和管理多维表格
- ✅ 获取多维表格信息
- ✅ 读取多维表格记录

在飞书开放平台（https://open.feishu.cn/app）中：
1. 进入您的应用
2. 点击"权限管理"
3. 搜索"多维表格"相关权限并开启
4. 点击"发布版本"使权限生效

## 常见错误

### 错误 1: WrongBaseToken
```json
{
  "code": 1254003,
  "msg": "WrongBaseToken"
}
```
**原因**: app_token 不正确
**解决**: 按照上述方法重新获取正确的 app_token

### 错误 2: 权限不足
```json
{
  "code": 99991663,
  "msg": "permission denied"
}
```
**原因**: 应用没有访问该表格的权限
**解决**: 
1. 在飞书开放平台配置权限
2. 将应用添加到表格的协作者中

## 需要帮助？

如果按照上述步骤仍然无法获取 app_token，请：
1. 检查您是否有该表格的管理员权限
2. 确认表格是否为独立的多维表格（而非嵌入在知识库中的表格）
3. 联系飞书管理员获取帮助
