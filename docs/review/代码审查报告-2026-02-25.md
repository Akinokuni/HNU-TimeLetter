# HNU-TimeLetter 仓库代码审查报告（团队评审）

审查方式：
- 静态代码走查（架构层、页面层、脚本层）
- `eslint` 全量扫描
- 关键路径抽样（首页渲染、移动端详情、飞书同步脚本）

## 总体结论

项目整体结构清晰，模块边界明确（`app` / `components` / `lib` / `scripts` 分层），并且具备较完整的业务文档与脚本化同步流程，**适合继续迭代**。

但当前存在三类阻断风险：
1. **质量门禁未通过**：`npm run lint` 存在 17 个 error，CI 若启用将直接阻塞交付。
2. **类型安全被弱化**：核心 UI 与数据同步脚本存在大量 `any`，削弱重构安全性。
3. **全局状态污染风险**：移动端手势逻辑将临时状态挂在 `window` 上，存在组件间串扰可能。

建议先做一轮“稳定性修复 Sprint”（1~2 天），优先清空 lint error 与关键交互隐患，再继续新功能开发。

## 关键发现（按优先级）

### P0（必须尽快处理）

1. **Lint 全量失败（17 errors）**
   - 现象：`@typescript-eslint/no-explicit-any`、`prefer-const` 等规则触发。
   - 影响：无法建立稳定质量门禁，后续回归成本上升。
   - 建议：
     - UI 层优先替换事件类型：`event: any` -> `MouseEvent | PointerEvent | TouchEvent`（按 framer-motion 类型约束落地）。
     - 脚本层优先对 Feishu API 响应建立最小可用类型（如 `FeishuRecord`, `FeishuAttachment`）。
     - 同步修复 `let allItems` 可改为 `const` 的语句。

2. **移动端组件使用 `window as any` 记录手势起点**
   - 位置：`MobileDetailModal` 文本区 `onTouchStart/onTouchEnd`。
   - 影响：
     - 多实例或并发手势时可能相互覆盖；
     - 测试与维护成本高；
     - 与类型系统冲突。
   - 建议：改为 `useRef<number | null>` 存储 `startX`，并在 `touchend/cancel` 后重置。

### P1（建议本迭代处理）

3. **图片组件普遍开启 `unoptimized`，弱化 Next Image 优化收益**
   - 影响：首屏与详情页图片体积/加载时间可能上升，移动端更明显。
   - 建议：
     - 对 OSS 域名白名单已配置，可逐步移除 `unoptimized` 并观察回归；
     - 对大图补充 `sizes` 与清晰的容器尺寸策略。

4. **数据同步脚本职责偏重，缺乏分层抽象**
   - 现状：`sync-feishu.ts` 同时负责鉴权、拉取、上传 OSS、回写、转换、落盘。
   - 影响：可测试性与可维护性下降，问题定位成本高。
   - 建议：拆分为 `feishu-client` / `oss-service` / `transformer` / `writer` 四层，并为 `transformer` 增加纯函数单测。

### P2（持续优化项）

5. **客户端宽度判断与首屏空白策略可进一步优化**
   - 现状：首页通过 `mounted` 门控避免 hydration mismatch，首帧渲染空容器。
   - 建议：
     - 可评估 CSS 媒体查询主导的渐进增强方案；
     - 或将移动端/桌面端差异尽量放到样式层，减少 JS 级分支。

## 亮点

- 组件职责较清楚，桌面端与移动端体验拆分合理；
- 状态管理简单直接（Zustand），业务状态命名可读性高；
- 飞书同步链路考虑了 OSS 去重（MD5）与回写，具备实用工程价值；
- 文档体系完善，角色分工与设计资产组织良好。

## 建议的两周改进路线图

### 第 1 周（稳态修复）
- 清零 `eslint` error；
- 消除 UI 层 `any` 与 `window` 污染；
- 为同步脚本补充最小类型定义；
- 在 CI 加入 `npm run lint` 阶段性门禁。

### 第 2 周（性能与可维护性）
- 收敛 `unoptimized` 的使用范围并做对比测试；
- 拆分同步脚本并为纯转换逻辑补测试；
- 补一份“线上故障排查手册”（飞书鉴权、附件下载、OSS 上传常见错误码）。

## 结语

该仓库已具备不错的产品化雏形。建议以“先稳定、再加速”为节奏推进：
- 先让质量门禁恢复可信；
- 再针对性能与脚本工程化做中期投入。

按上述节奏推进后，项目在可持续迭代能力上会有明显提升。
